{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"version": "1.21.7",
	"title": "Bestiary Schema",
	"$id": "bestiary.json",
	"type": "object",
	"definitions": {
		"align": {
			"oneOf": [
				{
					"$ref": "../util.json#/definitions/alignment"
				},
				{
					"type": "object",
					"properties": {
						"alignment": {
							"type": "array",
							"items": {
								"$ref": "../util.json#/definitions/alignment"
							}
						},
						"chance": {
							"type": "integer"
						},
						"note": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["alignment"]
				},
				{
					"type": "object",
					"properties": {
						"special": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["special"]
				}
			]
		},
		"acItem": {
			"oneOf": [
				{
					"type": "object",
					"properties": {
						"ac": {
							"type": "integer"
						},
						"from": {
							"type": "array",
							"items": {
								"type": "string"
							}
						},
						"condition": {
							"type": "string"
						},
						"braces": {
							"type": "boolean"
						}
					},
					"required": ["ac"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"special": {
							"type": "string"
						}
					},
					"required": ["special"],
					"additionalProperties": false
				},
				{
					"type": "integer"
				}
			]
		},

		"creatureData":  {
			"type": "object",
			"properties": {
				"name": {
					"type": "string"
				},
				"shortName": {
					"description": "Used anywhere a shortened form of the creatures name is required (e.g. in legendary action headers).\nIf not supplied, a shortened name will be automatically generated from the creature's full name.\nAlternatively use \"true\" if the \"shortName\" should be an exact copy of the creature's \"name\".",
					"type": ["string", "boolean"]
				},
				"alias": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"group": {
					"description": "A group name, indexed by search. E.g. searching \"Lycanthrope\" would otherwise fail to find anything.\nOnly works on the bestiary page, not in the full site search.",
					"type": [
						"null",
						"array"
					],
					"items": {
						"type": "string"
					}
				},
				"level": {
					"description": "Used in sidekicks, which can have levels (and generally do not have alignment)",
					"type": "integer"
				},
				"size": {
					"type": "array",
					"items": {
						"$ref": "../util.json#/definitions/size"
					},
					"uniqueItems": true
				},
				"sizeNote": {
					"type": "string"
				},
				"type": {
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"type": {
									"$ref": "../util.json#/definitions/creatureType"
								},
								"swarmSize": {
									"$ref": "../util.json#/definitions/size",
									"description": "Size of the individual creatures that make up the swarm."
								},
								"tags": {
									"type": "array",
									"uniqueItems": true,
									"items": {
										"oneOf": [
											{
												"type": "string"
											},
											{
												"type": "object",
												"properties": {
													"tag": {
														"type": "string"
													},
													"prefix": {
														"type": "string"
													}
												},
												"required": [
													"tag",
													"prefix"
												],
												"additionalProperties": false
											}
										]
									}
								}
							},
							"required": [
								"type"
							],
							"additionalProperties": false
						},
						{
							"$ref": "../util.json#/definitions/creatureType"
						}
					]
				},
				"source": {
					"type": "string"
				},
				"sourceSub": {
					"type": "string",
					"description": "Sub-source text that is shown when hovered."
				},
				"otherSources": {
					"$ref": "../util.json#/definitions/otherSources"
				},
				"reprintedAs": {
					"$ref": "../util.json#/definitions/reprintedAs"
				},
				"alignment": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/align"
					}
				},
				"alignmentPrefix": {"type": "string"},
				"ac": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/acItem"
					}
				},
				"hp": {
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"average": {"type": "integer"},
								"formula": {"type": "string"}
							},
							"required": ["average", "formula"],
							"additionalProperties": false
						},
						{
							"type": "object",
							"properties": {
								"special": {
									"type": "string"
								}
							},
							"additionalProperties": false
						}
					]
				},
				"speed": {
					"$ref": "../util.json#/definitions/speed"
				},
				"str": {"type": ["integer", "null"]},
				"dex": {"type": ["integer", "null"]},
				"con": {"type": ["integer", "null"]},
				"int": {"type": ["integer", "null"]},
				"wis": {"type": ["integer", "null"]},
				"cha": {"type": ["integer", "null"]},
				"save": {
					"type": "object",
					"properties": {
						"str": {"type": "string"},
						"dex": {"type": "string"},
						"con": {"type": "string"},
						"int": {"type": "string"},
						"wis": {"type": "string"},
						"cha": {"type": "string"},
						"$$ifBrew": {
							"special": {
								"description": "For use in homebrew.",
								"$ref": "../entry.json"
							}
						}
					},
					"additionalProperties": false
				},
				"skill": {
					"type": "object",
					"properties": {
						"acrobatics": {
							"type": "string"
						},
						"animal handling": {
							"type": "string"
						},
						"arcana": {
							"type": "string"
						},
						"athletics": {
							"type": "string"
						},
						"deception": {
							"type": "string"
						},
						"history": {
							"type": "string"
						},
						"insight": {
							"type": "string"
						},
						"intimidation": {
							"type": "string"
						},
						"investigation": {
							"type": "string"
						},
						"medicine": {
							"type": "string"
						},
						"nature": {
							"type": "string"
						},
						"perception": {
							"type": "string"
						},
						"performance": {
							"type": "string"
						},
						"persuasion": {
							"type": "string"
						},
						"religion": {
							"type": "string"
						},
						"sleight of hand": {
							"type": "string"
						},
						"stealth": {
							"type": "string"
						},
						"survival": {
							"type": "string"
						},
						"other": {
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"oneOf": {
										"type": "object",
										"properties": {
											"acrobatics": {"type": "string"},
											"animal handling": {"type": "string"},
											"arcana": {"type": "string"},
											"athletics": {"type": "string"},
											"deception": {"type": "string"},
											"history": {"type": "string"},
											"insight": {"type": "string"},
											"intimidation": {"type": "string"},
											"investigation": {"type": "string"},
											"medicine": {"type": "string"},
											"nature": {"type": "string"},
											"perception": {"type": "string"},
											"performance": {"type": "string"},
											"persuasion": {"type": "string"},
											"religion": {"type": "string"},
											"sleight of hand": {"type": "string"},
											"stealth": {"type": "string"},
											"survival": {"type": "string"}
										}
									}
								}
							}
						},
						"$$ifBrew": {
							"special": {
								"description": "For use in homebrew.",
								"$ref": "../entry.json"
							}
						}
					},
					"additionalProperties": false
				},
				"senses": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "string"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"passive": {
					"type": ["integer", "string", "null"]
				},
				"languages": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "string"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"pbNote": {
					"type": "string"
				},
				"cr": {
					"oneOf": [
						{
							"type": "string"
						},
						{
							"type": "object",
							"properties": {
								"cr": {
									"type": "string"
								},
								"lair": {
									"type": "string"
								},
								"coven": {
									"type": "string"
								},
								"xp": {
									"type": "integer"
								}
							},
							"additionalProperties": false,
							"required": ["cr"]
						}
					]
				},
				"vulnerable": {
					"$ref": "../util.json#/definitions/damageVulnerabilityArray"
				},
				"resist": {
					"$ref": "../util.json#/definitions/damageResistArray"
				},
				"immune": {
					"$ref": "../util.json#/definitions/damageImmunityArray"
				},
				"conditionImmune": {
					"$ref": "../util.json#/definitions/conditionImmunityArray"
				},
				"spellcasting": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"$ref": "../entry.json#/definitions/entrySpellcasting"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"trait": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"entries": {
										"type": "array",
										"items": {
											"$ref": "../entry.json"
										}
									},
									"type": {
										"type": "string",
										"enum": ["entries", "inset"]
									},
									"sort": {
										"description": "Forces a sort order. Traits with sort orders will always be arranged before those without.",
										"type": "integer"
									}
								},
								"required": [
									"name",
									"entries"
								],
								"additionalProperties": false
							}
						},
						{
							"type": "null"
						}
					]
				},
				"actionNote": {
					"type": "string"
				},
				"actionHeader": {
					"type": "array",
					"items": {
						"$ref": "../entry.json"
					}
				},
				"action": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"entries": {
										"type": "array",
										"items": {
											"$ref": "../entry.json"
										}
									}
								},
								"required": [
									"name",
									"entries"
								],
								"additionalProperties": false
							}
						},
						{
							"type": "null"
						}
					]
				},
				"bonusNote": {
					"type": "string"
				},
				"bonusHeader": {
					"type": "array",
					"items": {
						"$ref": "../entry.json"
					}
				},
				"bonus": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"type": "string"
							},
							"entries": {
								"type": "array",
								"items": {
									"$ref": "../entry.json"
								}
							}
						},
						"required": [
							"name",
							"entries"
						],
						"additionalProperties": false
					}
				},
				"reactionNote": {
					"type": "string"
				},
				"reactionHeader": {
					"type": "array",
					"items": {
						"$ref": "../entry.json"
					}
				},
				"reaction": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"type": "string"
							},
							"entries": {
								"type": "array",
								"items": {
									"$ref": "../entry.json"
								}
							}
						},
						"required": [
							"name",
							"entries"
						],
						"additionalProperties": false
					}
				},
				"legendaryGroup": {
					"type": "object",
					"properties": {
						"name": {
							"type": "string"
						},
						"source": {
							"type": "string"
						}
					}
				},
				"legendaryActions": {
					"type": "number"
				},
				"legendaryHeader": {
					"type": "array",
					"items": {
						"$ref": "../entry.json"
					}
				},
				"legendary": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"entries": {
										"type": "array",
										"items": {
											"$ref": "../entry.json"
										}
									}
								},
								"required": [
									"entries"
								],
								"additionalProperties": false
							}
						},
						{
							"type": "null"
						}
					]
				},
				"mythicHeader": {
					"type": "array",
					"items": {
						"$ref": "../entry.json"
					}
				},
				"mythic": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"type": "string"
							},
							"entries": {
								"type": "array",
								"items": {
									"$ref": "../entry.json"
								}
							}
						},
						"required": [
							"entries"
						],
						"additionalProperties": false
					}
				},
				"variant": {
					"type": "array",
					"items": {"$ref": "#/definitions/entryVariantBestiary"}
				},
				"page": {"$ref": "../util.json#/definitions/page"},
				"familiar": {
					"type": "boolean"
				},
				"additionalSources": {
					"$ref": "../util.json#/definitions/additionalSources"
				},
				"hasToken": {
					"type": "boolean"
				},
				"tokenUrl": {
					"type": "string"
				},
				"altArt": {
					"type": "array",
					"items": {
						"anyOf":[
							{
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"source": {
										"type": "string"
									},
									"page": {"$ref": "../util.json#/definitions/page"}
								},
								"required": ["name", "source"]
							},
							{
								"$$ifBrew_item": {
									"type": "object",
									"description": "An URL pointing to an alternative token for the creature.",
									"properties": {
										"tokenUrl": {
											"type": "string"
										}
									},
									"required": ["tokenUrl"],
									"additionalProperties": false
								}
							}
						]
					}
				},
				"$$ifBrew": {
					"externalSources": {
						"description": "For homebrew use only.",
						"type": "array",
						"items": {
							"type": "object",
							"properties": {
								"entry": {
									"$ref": "../entry.json"
								}
							},
							"required": [
								"entry"
							],
							"additionalProperties": false
						}
					},
					"fluff": {
						"description": "This is intended to be used for Homebrew only - site data should include a fluff file per source",
						"anyOf": [
							{
								"$ref": "../util.json#/definitions/fluffObject"
							},
							{
								"description": "Reference \"monsterFluff\" array items",
								"type": "object",
								"properties": {
									"_monsterFluff": {
										"type": "object",
										"properties": {
											"name": {
												"type": "string"
											},
											"source": {
												"type": "string"
											}
										}
									},
									"_appendMonsterFluff": {
										"type": "object",
										"properties": {
											"name": {
												"type": "string"
											},
											"source": {
												"type": "string"
											}
										}
									}
								}
							}
						]
					},
					"foundryImg": {
						"$ref": "../util.json#/definitions/foundryImg"
					}
				},
				"isNamedCreature": {
					"type": "boolean"
				},
				"isNpc": {
					"description": "Used to flag adventure NPCs",
					"type": "boolean"
				},
				"environment": {
					"type": "array",
					"items": {
						"type": "string",
						"$$ifSiteElse_key": {
							"keySite": "enum",
							"keyBrew": "examples",
							"value": [
								"underwater",
								"coastal",
								"mountain",
								"grassland",
								"hill",
								"arctic",
								"urban",
								"forest",
								"swamp",
								"underdark",
								"desert"
							]
						}
					}
				},
				"soundClip": {
					"$ref": "../entry.json#/definitions/mediaHref"
				},
				"dragonCastingColor": {
					"type": "string",
					"$$ifSiteElse_key": {
						"keySite": "enum",
						"keyBrew": "examples",
						"value": ["black", "blue", "green", "red", "white", "brass", "bronze", "copper", "gold", "silver", "deep"]
					}
				},
				"dragonAge": {
					"type": "string",
					"$$ifSiteElse_key": {
						"keySite": "enum",
						"keyBrew": "examples",
						"value": [
							"young",
							"adult",
							"wyrmling",
							"greatwyrm",
							"ancient",
							"aspect"
						]
					}
				},
				"traitTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"Aggressive",
							"Ambusher",
							"Amorphous",
							"Amphibious",
							"Antimagic Susceptibility",
							"Brute",
							"Charge",
							"Damage Absorption",
							"Death Burst",
							"Devil's Sight",
							"False Appearance",
							"Fey Ancestry",
							"Flyby",
							"Hold Breath",
							"Illumination",
							"Immutable Form",
							"Incorporeal Movement",
							"Keen Senses",
							"Legendary Resistances",
							"Light Sensitivity",
							"Magic Resistance",
							"Magic Weapons",
							"Pack Tactics",
							"Pounce",
							"Rampage",
							"Reckless",
							"Regeneration",
							"Rejuvenation",
							"Shapechanger",
							"Siege Monster",
							"Sneak Attack",
							"Spell Immunity",
							"Spider Climb",
							"Sunlight Sensitivity",
							"Tree Stride",
							"Turn Immunity",
							"Turn Resistance",
							"Undead Fortitude",
							"Unusual Nature",
							"Water Breathing",
							"Web Sense",
							"Web Walker"
						]
					}
				},
				"actionTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"Breath Weapon",
							"Frightful Presence",
							"Multiattack",
							"Parry",
							"Shapechanger",
							"Swallow",
							"Teleport",
							"Tentacles"
						]
					}
				},
				"languageTags": {
					"type": "array",
					"items": {
						"type": "string",
						"description": "X: Any (Choose)\n XX: All\n CS: Can't Speak Known Languages\n LF: Languages Known in Life\n TP: Telepathy\n OTH: Other\n -\n AB: Abyssal\n AQ: Aquan\n AU: Auran\n C: Common\n CE: Celestial\n D: Dwarvish\n DR: Draconic\n DS: Deep Speech\n DU: Druidic\n E: Elvish\n G: Gnomish\n GI: Giant\n GO: Goblin\n GTH: Gith\n H: Halfling\n I: Infernal\n IG: Ignan\n O: Orc\n  P: Primordial\n S: Sylvan\n T: Terran\n TC: Thieves' cant\n U: Undercommon\n ",
						"enum": [
							"AB", "AQ", "AU", "C", "CE", "CS", "D", "DR", "DS", "DU", "E", "G", "GI", "GO", "GTH", "H", "I", "IG", "LF", "O", "OTH", "P", "S", "T", "TC", "TP", "U", "X", "XX"
						]
					}
				},
				"senseTags": {
					"type": "array",
					"items": {
						"type": "string",
						"description": "B: Blindsight\n D: Darkvision\n SD: Superior Darkvision\n T: Tremorsense\n U: Truesight",
						"enum": ["B", "D", "SD", "T", "U"]
					}
				},
				"spellcastingTags": {
					"type": "array",
					"items": {
						"type": "string",
						"description": "P: Psionics\n I: Innate\n F: Form Only\n S: Shared\n O: Other\n CA: Class, Artificer\n CB: Class, Bard\n CC: Class, Cleric\n CD: Class, Druid\n CP: Class, Paladin\n CR: Class, Ranger\n CS: Class, Sorcerer\n CL: Class, Warlock\n CW: Class, Wizard",
						"enum": ["P", "I", "F", "S", "O", "CA", "CB", "CC", "CD", "CP", "CR", "CS", "CL", "CW"]
					}
				},
				"damageTags": {
					"type": "array",
					"items": {
						"$ref": "../util.json#/definitions/dataDamageTags"
					}
				},
				"damageTagsSpell": {
					"type": "array",
					"items": {
						"$ref": "../util.json#/definitions/dataDamageTags"
					}
				},
				"damageTagsLegendary": {
					"type": "array",
					"items": {
						"$ref": "../util.json#/definitions/dataDamageTags"
					}
				},
				"miscTags": {
					"type": "array",
					"items": {
						"description": "AOE: Has Areas of Effect\n HPR: Has HP Reduction\n MW: Has Weapon Attacks, Melee\n RW: Has Weapon Attacks, Ranged\n RCH: Has Reach Attacks\n RNG: Has Ranged Weapons\n THW: Has Thrown Weapons",
						"enum": ["AOE", "HPR", "MW", "RW", "RCH", "RNG", "THW"]
					}
				},
				"conditionInflict": {
					"$ref": "../util.json#/definitions/tagsConditions"
				},
				"conditionInflictLegendary": {
					"$ref": "../util.json#/definitions/tagsConditions"
				},
				"conditionInflictSpell": {
					"$ref": "../util.json#/definitions/tagsConditions"
				},
				"footer": {
					"description": "Intended for homebrew use only.",
					"type": "array",
					"items": {
						"$ref": "../entry.json"
					}
				},
				"srd": {
					"$ref": "../util.json#/definitions/srd"
				},
				"basicRules": {
					"$ref": "../util.json#/definitions/basicRules"
				},
				"summonedBySpell": {
					"description": "The spell used to summon this creature; specifically for TCE-esque summon spells.",
					"type": "string"
				},
				"summonedBySpellLevel": {
					"description": "The level of the spell used to summon this creature; specifically for TCE-esque summon spells.",
					"type": "integer"
				},
				"summonedByClass": {
					"description": "The class which can summon this creature; e.g. for those granted by some TCE class features.",
					"type": "string"
				},
				"_isCopy": {
					"description": "An internal flag indicating this creature is a copy of another, and is a temporary/placeholder entry which will be factored out using the \"_copy\" format at a later date.",
					"type": "boolean"
				},
				"_versions": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/creatureVersion"
					}
				},
				"hasFluff": {"type": "boolean"},
				"hasFluffImages": {"type": "boolean"}
			},
			"additionalProperties": false
		},

		"creature": {
			"anyOf": [
				{
					"type": "object",
					"$$merge": [
						{
							"$ref": "#/definitions/creatureData"
						},
						{
							"required": [
								"name",
								"size",
								"type",
								"source",
								"ac",
								"hp",
								"speed",
								"str",
								"dex",
								"con",
								"int",
								"wis",
								"cha",
								"passive"
							]
						}
					]
				},
				{
					"type": "object",
					"$comment": "This is a custom pre-processor tag, which merges together the array of objects into one. This allows proper inheritance, which JSON schema don't really do.",
					"$$merge": [
						{
							"$ref": "#/definitions/creatureData"
						},
						{
							"$ref": "../util.json#/definitions/copyBlock"
						}
					]
				}
			]
		},

		"variantVersion": {
			"type": "object",
			"properties": {
				"_version": {
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"name": {"type": "string"},
								"source": {"type": "string"},
								"addAs": {"type": "string"}
							},
							"required": ["addAs"],
							"additionalProperties": false
						},
						{
							"type": "object",
							"properties": {
								"name": {"type": "string"},
								"source": {"type": "string"},
								"addHeadersAs": {"type": "string"}
							},
							"required": ["addHeadersAs"],
							"additionalProperties": false
						}
					]
				}
			}
		},

		"variantToken": {
			"type": "object",
			"properties": {
				"token": {
					"type": "object",
					"properties": {
						"name": {"type": "string"},
						"source": {"type": "string"},
						"page": {"$ref": "../util.json#/definitions/page"}
					},
					"required": ["name", "source"]
				}
			}
		},

		"entryVariantBestiary": {
			"anyOf": [
				{
					"type": "object",
					"$$merge": [
						{"$ref": "../entry.json#/definitions/entryVariant"},
						{"$ref": "#/definitions/variantToken"},
						{"$ref": "#/definitions/variantVersion"}
					]
				},
				{
					"type": "object",
					"$$merge": [
						{"$ref": "../entry.json#/definitions/entryInset"},
						{"$ref": "#/definitions/variantToken"},
						{"$ref": "#/definitions/variantVersion"}
					]
				}
			]
		},

		"creatureVersion": {
			"anyOf": [
				{"$ref": "../util.json#/definitions/version"},
				{"$ref": "#/definitions/creatureData"}
			]
		}
	},
	"properties": {
		"monster": {
			"type": "array",
			"uniqueItems": true,
			"items": {
				"$ref": "#/definitions/creature"
			}
		},
		"_meta": {
			"$ref": "../util.json#/definitions/metaBlock"
		}
	},
	"additionalProperties": false
}
